window.onload=function(){window.Employee=Backbone.Model.extend({validate:function(e){for(var t in e){if(""==e[t])return t+"不能为空";if("age"==t&&isNaN(e.age))return"年龄必须是数字"}}}),window.EmployeeList=Backbone.Collection.extend({model:Employee,localStorage:new Store("employees")}),window.Employees=new EmployeeList,window.EmployeeView=Backbone.View.extend({tagName:"tr",template:_.template($("#item-template").html()),events:{"dblclick td":"edit","blur input,select":"close","click .del":"clear"},initialize:function(){this.model.bind("change",this.render,this),this.model.bind("destroy",this.remove,this)},setText:function(){var e=this.model;this.input=$(this.el).find("input,select"),this.input.each(function(){var t=$(this);t.val(e.get(t.attr("name")))})},close:function(e){var t=$(e.currentTarget),n={};n[t.attr("name")]=t.val(),this.model.save(n),$(e.currentTarget).parent().parent().removeClass("editing")},edit:function(e){$(e.currentTarget).addClass("editing").find("input,select").focus()},render:function(){return $(this.el).html(this.template(this.model.toJSON())),this.setText(),this},remove:function(){$(this.el).remove()},clear:function(){console.log(this.model),this.model.destroy()}}),window.AppView=Backbone.View.extend({el:$("#app"),events:{"click .#add-btn":"createOnEnter"},initialize:function(){Employees.bind("add",this.addOne,this),Employees.bind("reset",this.addAll,this),Employees.fetch()},createOnEnter:function(e){var t=new Employee,n={};$("#emp-form input,#emp-form select").each(function(){var e=$(this);n[e.attr("name")]=e.val()}),t.bind("error",function(e,t){alert(t)}),t.set(n)&&Employees.create(t)},addOne:function(e){e.set({eid:e.get("eid")||Employees.length}),e.bind("error",function(e,t){alert(t)});var t=new EmployeeView({model:e});$(".emp-table tbody").append(t.render().el)},addAll:function(){Employees.each(this.addOne)}}),window.App=new AppView};